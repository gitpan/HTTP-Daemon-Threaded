
<html>
<head>
<title>HTTP::Daemon::Threaded::WebClient</title>
</head>
<body>
<table width='100%' border=0 CELLPADDING='0' CELLSPACING='3'>
<TR>
<TD VALIGN='top' align=left><FONT SIZE='-2'>
 SUMMARY:&nbsp;<A HREF='#constructor_summary'>CONSTR</a>&nbsp;|&nbsp;<A HREF='#method_summary'>METHOD</a>
 </FONT></TD>
<TD VALIGN='top' align=right><FONT SIZE='-2'>
DETAIL:&nbsp;<A HREF='#constructor_detail'>CONSTR</a>&nbsp;|&nbsp;<A HREF='#method_detail'>METHOD</a>
</FONT></TD>
</TR>
</table><hr>
<h2>Class HTTP::Daemon::Threaded::WebClient</h2>

<p>
<dl>
<dt><b>Inherits from:</b>
<dd><a href='../../../Thread/Apartment/MuxServer.html'>Thread::Apartment::MuxServer</a></dd>
<dd><a href='../../../HTTP/Daemon/Threaded/Logable.html'>HTTP::Daemon::Threaded::Logable</a></dd>
</dt>
</dl>

<hr>

Provides web-based request handling. A pool of WebClient
objects are created and managed by HTTP::Daemon::Threaded::Listener. As
web connection requests are received, a WebClient
is allocated and assigned the network connection. A minimal
HTTP protocol implementation is provided via a subclass of HTTP::Daemon::ClientConn.
As requests are received, they are processed as needed,
possibly resulting in calls to any installed content handler components.
<p>
Content handlers are specified as an arrayref of 2-tuples
consisting of
<pre>
[ regular expression string, content handler class name ]
</pre>
When a client HTTP request is received, each registered content handler's regular expression
string is applied to the URI <i>in the order in which the handler's are listed in the
content handler map</i> until a match is found, at which point the content handler class's
<code>getContent()/putContent()/getHeader()</code> method is invoked.
If no regular expression matches the URI,
a HTTP 404 (NOT FOUND) error is returned to the client.
<p>
Application specific parameters for content handlers may be provided by
creating a concrete implemention of the HTTP::Daemon::Threaded::ContentParams
class, and supplying any constructor parameters as additional key/value
pairs in the WebClient constructor hash.
<p>
Copyright&copy 2006, Dean Arnold, Presicient Corp., USA<br>
All rights reserved.
<p>
Licensed under the Academic Free License version 2.1, as specified in the
License.txt file included in this software package, or at
<a href='http://www.opensource.org/licenses/afl-2.1.php'>OpenSource.org</a>.


<p>

<dl>

<dt><b>Author:</b></dt>
	<dd>D. Arnold</dd>

<dt><b>Version:</b></dt>
	<dd>0.90</dd>

<dt><b>Since:</b></dt>
	<dd>2006-08-21
</dd>

<p>
<i>Unless otherwise noted, <code>$self

</code> is the object instance variable.</i>
<p>
<table border=1 cellpadding=3 cellspacing=0 width='100%'>
<tr bgcolor='#9800B500EB00'><th align=left><font size='+2'>Constructor Summary</font></th></tr>

<tr><td align=left valign=top>
<code><a href='#HTTP::Daemon::Threaded::WebClient'>new</a>(HTTPD =&gt; <i>value</i>, LogLevel =&gt; <i>value</i>, EventLogger =&gt; <i>value</i>, WebLogger =&gt; <i>value</i>, Handlers =&gt; <i>value</i>, ID =&gt; <i>value</i>, InactivityTimer =&gt; <i>value</i>, ContentParams =&gt; <i>value</i>, UserAuth =&gt; <i>value</i>, SessionCache =&gt; <i>value</i>, DocRoot =&gt; <i>value</i>, URL =&gt; <i>value</i>, ProductTokens =&gt; <i>value</i>, MediaTypes =&gt; <i>value</i>, FreeList =&gt; <i>value</i>, SelectInterval =&gt; <i>value</i>)</code>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Creates an empty HTTP::Daemon::Threaded::Socket object
</td></tr>
</table><p>

<table border=1 cellpadding=3 cellspacing=0 width='100%'>
<tr bgcolor='#9800B500EB00'><th align=left><font size='+2'>Method Summary</font></th></tr>

<tr><td align=left valign=top>
<code><a href='#acceptConnection'>acceptConnection</a>($fn)</code>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Accepts a web client connection
</td></tr>

<tr><td align=left valign=top>
<code><a href='#freeClient'>freeClient</a>($client)</code>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Return a client to the free list
</td></tr>

<tr><td align=left valign=top>
<code><a href='#get_simplex_methods'>get_simplex_methods</a>()</code>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Overrides Thread::Apartment::Server::get_simplex_methods()
</td></tr>

<tr><td align=left valign=top>
<code><a href='#handleSocketEvent'>handleSocketEvent</a>($fd)</code>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Handles a socket event
</td></tr>

<tr><td align=left valign=top>
<code><a href='#run'>run</a>()</code>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Thread::Apartment::MuxServer::run() implementation
</td></tr>
</table>
<p>

<a name='constructor_detail'></a>
<table border=1 cellpadding=3 cellspacing=0 width='100%'>
<tr bgcolor='#9800B500EB00'>
	<th align=left><font size='+2'>Constructor Details</font></th>
</tr>
</table>

<a name='new'></a>
<h3>new</h3>
<pre>
new(HTTPD =&gt; <i>value</i>, LogLevel =&gt; <i>value</i>, EventLogger =&gt; <i>value</i>, WebLogger =&gt; <i>value</i>, Handlers =&gt; <i>value</i>, ID =&gt; <i>value</i>, InactivityTimer =&gt; <i>value</i>, ContentParams =&gt; <i>value</i>, UserAuth =&gt; <i>value</i>, SessionCache =&gt; <i>value</i>, DocRoot =&gt; <i>value</i>, URL =&gt; <i>value</i>, ProductTokens =&gt; <i>value</i>, MediaTypes =&gt; <i>value</i>, FreeList =&gt; <i>value</i>, SelectInterval =&gt; <i>value</i>)
</pre><p>
<dl>
<dd>Creates an empty HTTP::Daemon::Threaded::Socket object.
Creates any specified ContentParams object, and installs the content handler map.
<p>
Note that the following parameters are recognized by
HTTP::Daemon::Threaded::WebClient, but
applications may supply additional parameter key/value pairs
which will be provided to the constructor for any specified
HTTP::Daemon::Threaded::ContentParams class.


<p>
<dd><dl>
<dt><b>Parameters:</b>
<dd><code>HTTPD</code> =&gt; the parent daemon object
</dd>
<dd><code>LogLevel</code> =&gt; <i>(optional)</i> logging level; 1 => errors only; 2 => errors and warnings only; 3 => errors, warnings,
and info messages; default 1
</dd>
<dd><code>EventLogger</code> =&gt; <i>(optional)</i> Instance of a HTTP::Daemon::Threaded::Logger to receive
event notifications (except for web requests)
</dd>
<dd><code>WebLogger</code> =&gt; <i>(optional)</i> Instance of a HTTP::Daemon::Threaded::Logger to receive
web request notifications
</dd>
<dd><code>Handlers</code> =&gt; arrayref mapping URL regex strings to handler classes
</dd>
<dd><code>ID</code> =&gt; unique client identifier
</dd>
<dd><code>InactivityTimer</code> =&gt; <i>(optional)</i> number of seconds to wait before disconnecting an idle connection
</dd>
<dd><code>ContentParams</code> =&gt; <i>(optional)</i> name of a ContentsParam concrete implementation
</dd>
<dd><code>UserAuth</code> =&gt; <i>(optional)</i> User authentication package name <i>(not yet supported)</i>
</dd>
<dd><code>SessionCache</code> =&gt; <i>(optional)</i> threads::shared object implementing HTTP::Daemon::Threaded::SessionCache
</dd>
<dd><code>DocRoot</code> =&gt; <i>(optional)</i> root directory for default file based content handler
</dd>
<dd><code>URL</code> =&gt; the base address/port of our listener
</dd>
<dd><code>ProductTokens</code> =&gt; product token string from listener
</dd>
<dd><code>MediaTypes</code> =&gt; <i>(optional)</i> hashref mapping 'Content-Type' specifications to
file qualifier strings. Values may be either a single string literal, or
an arrayref of string literals, e.g.,<br>
<code>MediaTypes =&gt; { 'text/css' => 'css' }</code>. Used to
add media types for LWP::MediaTypes::guess_media_type()
</dd>
<dd><code>FreeList</code> =&gt; free client list; threads::shared array optimized to quickly
allocate/free WebClient objects
</dd>
<dd><code>SelectInterval</code> =&gt; seconds to wait in select()'s on sockets. May be fractional; default 0.5

</dd>
<dt><b>Returns:</b><dd>HTTP::Daemon::Threaded::WebClient object
</dd>
</dl></dd></dl><hr>

<p>

<a name='method_detail'></a>
<table border=1 cellpadding=3 cellspacing=0 width='100%'>
<tr bgcolor='#9800B500EB00'>
	<th align=left><font size='+2'>Method Details</font></th>
</tr></table>

<a name='acceptConnection'></a>
<h3>acceptConnection</h3>
<pre>
acceptConnection($fn)
</pre><p>
<dl>
<dd>Accepts a web client connection. Called from HTTP::Daemon::Threaded when a new connection
event occurs. Collects the peer info for logging purposes.
Converts the supplied socket file number to a HTTP::Daemon::Threaded::Socket
object.


<p>
<dd><dl>
<dt><b>Parameters:</b>
<dd><code>$fn</code> - file number of the new socket

</dd>
<dt><b>Returns:</b><dd>the object
</dd>
<dt><b>See Also:</b></dt><dd><a href='../../../HTTP/Daemon/Threaded/Socket.html'>HTTP::Daemon::Threaded::Socket</a></dd>
</dl></dd></dl><hr>

<a name='freeClient'></a>
<h3>freeClient</h3>
<pre>
freeClient($client)
</pre><p>
<dl>
<dd>Return a client to the free list.


<p>
<dd><dl>
<dt><b>Parameters:</b>
<dd><code>$client</code> - ID of the client being freed

</dd>
<dt><b>Returns:</b><dd>1
</dd>
</dl></dd></dl><hr>

<a name='get_simplex_methods'></a>
<h3>get_simplex_methods</h3>
<pre>
get_simplex_methods()
</pre><p>
<dl>
<dd>Overrides Thread::Apartment::Server::get_simplex_methods().


<p>
<dd><dl>
<dt><b>Returns:</b><dd>hashref of simplex method names
</dd>
</dl></dd></dl><hr>

<a name='handleSocketEvent'></a>
<h3>handleSocketEvent</h3>
<pre>
handleSocketEvent($fd)
</pre><p>
<dl>
<dd>Handles a socket event. Accumulates a client request, parses it,
and then dispatches to the associated URL handler. Only a single
client request is handled, but the connection may be retained
indefinitely (for HTTP 1.1 Connection: keepalive clients).


<p>
<dd><dl>
<dt><b>Parameters:</b>
<dd><code>$fd</code> - the HTTP::Daemon::Threaded::Socket object on which the event occured

</dd>
<dt><b>Returns:</b><dd>the object
</dd>
</dl></dd></dl><hr>

<a name='run'></a>
<h3>run</h3>
<pre>
run()
</pre><p>
<dl>
<dd>Thread::Apartment::MuxServer::run() implementation.


<p>
<dd><dl>
<dt><b>Returns:</b><dd>1
</dd>
</dl></dd></dl><hr>

<small>
<center>
<i>Generated by psichedoc on Mon Aug 28 09:45:39 2006</i>
</center>
</small>
</body>
</html>
